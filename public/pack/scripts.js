var App=angular.module("App",["ngSanitize","ui.router","ui.sortable","ui.bootstrap","templates"]);angular.module("App").config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(e,t,n,o){o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"],n.html5Mode(!0).hashPrefix("!"),t.otherwise("/"),e.state("index",{url:"/",controller:"CV_index as ctr",templateUrl:"templates/views/index.html"}).state("stats",{url:"/stats/?tag&c&t&s&tag2&t2&c2&s2",controller:"CV_stats as ctr",templateUrl:"templates/views/stats.html",reloadOnSearch:!1})}]),angular.module("App").constant("__api",{base:"http://www.sports.ru",paths:{search:"/search/search.json"}}),angular.module("App").run([function(){}]),angular.module("App").controller("C_background",["$state","$scope","PS_lastfm",function(e,t){var n=this,o="/images/background/intro.jpg";return n.image=o,t.$on("artistInfoRecievedFromLF",function(e,t){n.image=t.image}),t.$on("$stateChangeStart",function(e,t,a,r){"artistpage"!==r.name&&"artistpage.section"!==r.name||"artistpage"===t.name||"artistpage.section"===t.name||(n.image=o)}),n}]),angular.module("App").directive("autocompleteArea",[function(){return{scope:{info:"=",withButton:"=",info:"="},templateUrl:"templates/directives/autocompleteArea.html",controller:"CD_autocompleteArea as ctr",link:function(e,t){if(e.withButton){var n="notShowing",o=t.find("input"),a=$(document.createElement("div")).html("Сравнить с другим игроком").addClass("onfocusbutton btn btn-primary").on("click",function(){o.trigger("focus"),$(this).addClass(n)}).appendTo(t.find('[data-role="area"]'));o.on("blur",function(){""===$(this).val()&&a.removeClass(n)})}}}}]),angular.module("App").directive("colorPicker",[function(){return{scope:{color:"=colorPicker",colorChange:"&",tagNum:"="},link:function(e,t,n){return"undefined"==typeof e.color?void t.addClass("pickerIsInited").ColorPickerSliders({placement:n.placement||"right",hsvpanel:!0,sliders:!1,swatches:!1,previewformat:"hex"}):void e.$watch(function(){return e.color},function(o){o&&!t.hasClass("pickerIsInited")&&t.addClass("pickerIsInited").val(o).ColorPickerSliders({placement:n.placement||"right",hsvpanel:!0,sliders:!1,swatches:!1,previewformat:"hex",onchange:function(){if("function"==typeof e.colorChange){var n=t.val().replace("#","");e.colorChange({color:n,key:e.tagNum})}}})})}}}]),angular.module("App").directive("customSelect",function(){return{transclude:!0,scope:{selectId:"=customSelect",closeOnSelect:"=",options:"=",sectionFormat:"=",sectionDefault:"=",optionFormat:"=",optionDisabled:"&",optionActive:"&",onSelect:"&",options:"=",customContent:"="},controller:"CD_customSelect as cSCtr",templateUrl:"templates/directives/customSelect.html",link:function(e,t,n,o,a){var r=e.$parent.$new(),s=e;a(r,function(e,n){n.$close=s.cSCtr.close,t.find('[data-role="custom-content"]').append(e)}),t.find("menu").on("click",function(e){e.stopPropagation()})}}}),angular.module("App").directive("flagIcon",[function(){return{scope:{flag:"=flagIcon"},link:function(e,t){e.$watch("flag",function(e){e&&t.addClass("flag-icon-"+e)})}}}]),angular.module("App").directive("goalsTimeline",[function(){return{scope:{data:"=goalsTimeline",color:"="},link:function(e,t){var n;e.$watch("color",function(t){t&&e.data&&_.forEach(n.highcharts().series,function(e){e.options.color=t,e.update(e.options)})}),e.$watch("data",function(o){if(o){for(var a,r=[],s=_.max(o,function(e){return r.push(e.period),e.goals_count}).goals_count,a=[],i=0;s>i;i++){var l=[];_.forEach(o,function(e){l.push(e.goals_count>=i?1:0)}),a.push({data:l,color:e.color})}n=t.highcharts({chart:{type:"column"},title:{text:null},xAxis:{categories:r},yAxis:{min:0,lineWidth:0,minorGridLineWidth:0,gridLineWidth:0,lineColor:"transparent",title:{text:null},labels:{enabled:!1},minorTickLength:0,tickLength:0,stackLabels:{enabled:!0,style:{fontSize:"22px",bottom:"10px",color:Highcharts.theme&&Highcharts.theme.textColor||"#000"}}},legend:{enabled:!1},tooltip:{enabled:!1,formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+"<br/>Total: "+this.point.stackTotal}},plotOptions:{column:{stacking:"normal",animation:!1,dataLabels:{enabled:!1}},series:{states:{hover:{enabled:!1}}}},series:a}),n.find('text:contains("Highcharts.com")').remove()}})}}}]),angular.module("App").directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ngEnter)}),t.preventDefault())})}}),angular.module("App").directive("setBgOnLoad",["$timeout","S_utils",function(e,t){return{scope:{src:"=setBgOnLoad",newLayer:"="},link:function(n,o){var a;n.newLayer||(a=$(document.createElement("div")).addClass("layer").appendTo(o)),n.$watch("src",function(r){if(r){o.removeClass("active");var s=600,i=t.loadImage(n.src),l=(new Date).getTime();i.then(n.newLayer?function(){var t=o.find(".layer"),a=$(document.createElement("div")).addClass("layer").css({"background-image":"url("+n.src+")"}).appendTo(o);e(function(){a.addClass("active")},100),e(function(){t.remove()},s)}:function(){var t=(new Date).getTime();s>t-l?e(function(){a.css({"background-image":"url("+n.src+")"}).addClass("active")},s-(t-l)):a.css({"background-image":"url("+n.src+")"}).addClass("active")})}})}}}]),angular.module("App").service("S_api",["$http","$timeout","$q","__api",function(e,t,n,o){var a={},r=o.base;return a.searchByQuery=function(t){return e({url:r+o.paths.search,method:"GET",params:{query:t,only:"tags"}})},a.getTournamentsList=function(){var e=n.defer();return t(function(){e.resolve({tournamet_list:[{name:"Российская премьер-лига",seasons:[{id:354,name:"Сезон 2014/15"},{id:355,name:"Сезон 2013/14"},{id:356,name:"Сезон 2012/13"}],id:12423533},{name:"Какая-то еще лига",seasons:[{id:1355,name:"Сезон 2013/14"},{id:1356,name:"Сезон 2012/13"}],id:12423533}]})},1e3),e.promise},a.getTagStat=function(){var e=n.defer();return t(function(){e.resolve({player_name:"Александр",player_surname:"Кокорин",avatar:"http://s5o.ru/storage/simple/ru/edt/44/18/55/31/rue9281df824f.png",birth_date:"1982-11-03 00:00:00",height:182,weight:72,flag:{flag_url:"http://s5o.ru/common/css/i/flags-sprite.png",flag_country:"Россия",flag_code:"ru"},team:{name:"Динамо",logo:"http://s5o.ru/storage/simple/ru/edt/89/83/60/09/ruea2f670fde9.jpg",tag_url:"http://www.sports.ru/dynamo/"},amplua:"Нападающий",tag_url:"http://www.sports.ru/kokorin/",background_images:[{url:"http://s5o.ru/storage/simple/ru/edt/89/14/51/73/rue514b41dfa7.jpg"},{url:"http://s5o.ru/storage/simple/ru/edt/85/79/56/26/rue8607905bce.jpg"},{url:"http://s5o.ru/storage/simple/ru/edt/41/64/64/95/rued3d92c842a.jpg"},{url:"http://s5o.ru/storage/simple/ru/edt/84/42/72/05/rue31356179ee.jpg"},{url:"http://s5o.ru/storage/simple/ru/edt/86/02/54/20/ruef856755f40.jpg"},{url:"http://s5o.ru/storage/simple/ru/edt/86/08/53/34/rue2d9fc0aace.jpg"},{url:"http://s5o.ru/storage/simple/ru/edt/84/54/29/08/rue09a8cca094.jpg"},{url:"http://s5o.ru/storage/simple/ru/edt/20/22/21/27/rue05cdcac0cf.jpg"},{url:"http://s5o.ru/storage/simple/ru/edt/20/17/10/99/rue104243346a.jpg"},{url:"http://s5o.ru/storage/simple/ru/edt/52/82/45/89/ruefce727ee00.jpg"},{url:"http://s5o.ru/storage/simple/ru/edt/04/84/56/56/rue8839ad570a.49.670x1340.jpeg"},{url:"http://s5o.ru/storage/simple/ru/edt/03/57/60/36/ruef4b81e0a03.49.670x1340.jpeg"},{url:"http://s5o.ru/storage/simple/ru/edt/58/03/47/29/rue809df0a512.jpeg"},{url:"http://s5o.ru/storage/simple/ru/edt/34/75/58/95/rue9dadbe4331.49.670x1340.jpeg"}],stat:{season:"Сезон 2014/2015 ",tournament:"премьер-лига Россия",goals:6,goal_passes:5,minutes:984,efficient_minutes:90,goals_timeline:[{period:"0-15",goals_count:2},{period:"15-30",goals_count:1},{period:"30-45",goals_count:0},{period:"45-60",goals_count:0},{period:"60-75",goals_count:3},{period:"75-90",goals_count:2}],yellow_cards:1,red_cards:4,most_efficient_match:{},matches_count:12}})},1e3),e.promise},a}]),angular.module("App").service("S_location",["$location",function(e){var t;return t={setAttr:function(t,n){var o={};o[t]=n,e.search(angular.extend(e.$$search,o))}}}]),angular.module("App").service("S_utils",["$q",function(e){function t(e){var t="string"==typeof e?n(e):e;return.2126*t[0]+.7152*t[1]+.0722*t[2]}function n(e){if(3===e.length)e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2);else if(6!==e.length)throw"Invalid hex color: "+e;for(var t=[],n=0;2>=n;n++)t[n]=parseInt(e.substr(2*n,2),16);return t}var o={};return o.loadImage=function(t){var n=e.defer(),o=new Image;return o.src=t,o.onload=function(){n.resolve(this)},o.onerror=function(){n.reject(this)},n.promise},o.getVersusBackgrounds=function(){return["/images/versus-bg/fvs01.png","/images/versus-bg/fvs02.png","/images/versus-bg/fvs03.png","/images/versus-bg/fvs04.png","/images/versus-bg/fvs05.png","/images/versus-bg/fvs06.png","/images/versus-bg/fvs07.png"]},o.getContrastColor=function(e){return t(e)>=165?"000":"fff"},o}]),angular.module("App").controller("CD_autocompleteArea",["$scope","S_api",function(e,t){var n=this;return n.searchByQuery=function(e){return t.searchByQuery(e).then(function(e){return e.data.suggestions})},n.onTagSelect=function(t){e.info=t},n}]),angular.module("App").controller("CD_customSelect",["$timeout","$scope","$interpolate","$sce",function(e,t,n,o){var a=this;return t.length=123,t.$watch("sectionFormat",function(){t.section=o.trustAsHtml(n("<span>"+t.sectionFormat+"</span>")(t))}),a.close=function(){a.opened=!1,$("body").off("click")},a.open=function(){a.opened=!a.opened,a.opened?e(function(){$("body").on("click",function(){t.$apply(function(){a.opened=!1}),$(this).off("click")})}):$("body").off("click")},a.isDisabled=function(e){return t.optionDisabled()?t.optionDisabled()(e,t.selectId):void 0},a.isActive=function(e){return t.optionActive()?t.optionActive()(e,t.selectId):void 0},a.selectOption=function(e,n){e.stopPropagation(),t.selected=n,t.closeOnSelect&&a.open()},a}]),angular.module("App").controller("CV_index",["$state","$q","$scope","S_api","S_utils",function(e,t,n,o,a){var r=this;return r.leftSideInfo={selectedTournament:{},selectedSeason:{},info:{},color:"#A6FF00"},r.rightSideInfo={selectedTournament:{},selectedSeason:{},info:{},color:"#FFA600"},n.$watch(function(){return r.leftSideInfo.info},function(e){e&&e.name&&(r.leftSideInfo.info=e,r.leftSideInfo.preloadingTagInfo=!0,t.all({image:a.loadImage(e.img),tournaments:o.getTournamentsList(e)}).then(function(e){r.leftSideInfo.preloadingTagInfo=!1,r.leftSideInfo.tournaments=e.tournaments.tournamet_list}))}),n.$watch(function(){return r.rightSideInfo.info},function(e){e&&e.name&&(r.rightSideInfo.info=e,r.rightSideInfo.preloadingTagInfo=!0,t.all({image:a.loadImage(e.img),tournaments:o.getTournamentsList(e)}).then(function(e){r.rightSideInfo.preloadingTagInfo=!1,r.rightSideInfo.tournaments=e.tournaments.tournamet_list}))}),r.getCollectorByKey=function(e){return e?r.rightSideInfo:r.leftSideInfo},r.secondTagIsReady=function(){return r.showTagInfo[1]},r.selectParam=function(e,t,n){switch(n){case"tour":r.getCollectorByKey(e).selectedTournament.name!==t.name&&(r.getCollectorByKey(e).selectedSeason={}),r.getCollectorByKey(e).selectedTournament=t,r.getCollectorByKey(e).seasons=t.seasons;break;case"season":r.getCollectorByKey(e).selectedSeason=t}},r.setColor=function(e,t){r.getCollectorByKey(t).color=e.currentTarget.value},r.paramIsActive=function(e,t,n){switch(n){case"tour":return r.getCollectorByKey(e).selectedTournament.name===t.name;case"season":return r.getCollectorByKey(e).selectedSeason.name===t.name}},r.tournamentsIsLoaded=function(e){return r.getCollectorByKey(e).tournaments},r.tournamentIsSelected=function(e){return r.getCollectorByKey(e).selectedTournament.name},r.seasonIsSelected=function(e){return r.getCollectorByKey(e).selectedSeason.name},r.showTagPreloader=function(e){return r.getCollectorByKey(e).preloadingTagInfo===!0},r.statsButtonIsActive=function(){return r.rightSideInfo.info.name?r.seasonIsSelected(0)&&r.seasonIsSelected(1):r.seasonIsSelected(0)},r.getSelectPlaceholder=function(e,t){switch(t){case"tour":return r.getCollectorByKey(e).selectedTournament.name?r.getCollectorByKey(e).selectedTournament.name:"Выберите турнир";case"season":return r.getCollectorByKey(e).selectedSeason.name?r.getCollectorByKey(e).selectedSeason.name:"Выберите сезон"}return r.selectedParams[e].description?r.selectedParams[e].description:"Выберите параметр"},r.loadStats=function(){r.statsButtonIsActive()&&(r.seasonIsSelected(1)?e.go("^.stats",{tag:r.leftSideInfo.info.id,c:r.leftSideInfo.color.replace("#",""),t:r.leftSideInfo.selectedTournament.id,s:r.leftSideInfo.selectedSeason.id,tag2:r.rightSideInfo.info.id,c2:r.rightSideInfo.color.replace("#",""),t2:r.rightSideInfo.selectedTournament.id,s2:r.rightSideInfo.selectedSeason.id}):e.go("^.stats",{tag:r.leftSideInfo.info.id,c:r.leftSideInfo.color.replace("#",""),t:r.leftSideInfo.selectedTournament.id,s:r.leftSideInfo.selectedSeason.id}))},r}]),angular.module("App").controller("CV_stats",["$state","$timeout","$q","$scope","S_api","S_utils","S_location",function(e,t,n,o,a,r,s){var i=this,l=e.params.c,c=e.params.c2;return i.preloadingInfo=!0,i.solo={},i.versus={},i.yearsPlural={0:"",one:"{} год",few:"{} года",many:"{} лет",other:"{} года"},e.params.tag2?(i.oneTag=!1,n.all({tag1:a.getTagStat(e.params.tag),tag2:a.getTagStat(e.params.tag2)}).then(function(e){i.preloadingInfo=!1;var o=i.versus;o.tag1=e.tag1,o.tag2=e.tag2,o.mainImageIndex=0,o.background_images=r.getVersusBackgrounds(),o.mainImage=o.background_images[0],o.tag1.age=moment().diff(moment(o.tag1.birth_date,"YYYY-MM-DD HH:mm:ss"),"years"),o.tag2.age=moment().diff(moment(o.tag2.birth_date,"YYYY-MM-DD HH:mm:ss"),"years"),n.all({avatar1:r.loadImage(o.tag1.avatar),avatar2:r.loadImage(o.tag2.avatar),mainImage:r.loadImage(o.mainImage)}).then(function(){t(function(){i.readyToShow=!0},200)})})):(i.oneTag=!0,n.all({tag:a.getTagStat(e.params.tag)}).then(function(e){if(i.preloadingInfo=!1,e.tag){i.solo=e.tag,i.solo.mainImageIndex=0,i.solo.mainImage=e.tag.background_images[0];var o=moment(e.tag.birth_date,"YYYY-MM-DD HH:mm:ss");i.solo.age=moment().diff(o,"years"),i.solo.birthdayHuman=o.format("D MMMM YYYY")}n.all({avatar:r.loadImage(i.solo.avatar),mainImage:r.loadImage(i.solo.mainImage)}).then(function(){t(function(){i.readyToShow=!0},200)})})),i.getTagInfo=function(e){return"number"==typeof e?e?i.versus.tag2:i.versus.tag1:e},i.getColor=function(e){return"#"+(e?c:l)},i.getTextColor=function(e){return"#"+r.getContrastColor(e?c:l)},i.setColor=function(e,t){o.$apply(function(){t?(c=e,s.setAttr("c2",e)):(l=e,s.setAttr("c",e))})},i.nextTagImage=function(e){var t=i.getTagInfo(e),n=t.mainImageIndex,o=t.background_images.length;o-1>n+1?t.mainImageIndex++:t.mainImageIndex=0,t.mainImage=t.background_images[t.mainImageIndex]},i.toggleImage=function(e){var t=i.getTagInfo(e);t.witoutTopImage=!t.witoutTopImage},i.witoutBackground=function(e){return i.getTagInfo(e).witoutTopImage},i.sortableOptions={axis:"y",handle:".reorder"},i.bannedSections=[],i.sectionIsBanned=function(e){var t=_.find(i.bannedSections,function(t){return t===e});return t},i.toggleSection=function(e){var t=_.remove(i.bannedSections,function(t){return t===e});t&&t.length||i.bannedSections.push(e)},i.sliderInterval=3e3,i}]);