var App=angular.module("App",["ngSanitize","ui.router","ui.bootstrap","templates"]);angular.module("App").config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(e,t,n,o){o.defaults.useXDomain=!0,delete o.defaults.headers.common["X-Requested-With"],n.html5Mode(!0).hashPrefix("!"),t.otherwise("/"),e.state("index",{url:"/",controller:"CV_index as ctr",templateUrl:"templates/views/index.html"}).state("stats",{url:"/stats/",controller:"CV_stats as ctr",templateUrl:"templates/views/stats.html"})}]),angular.module("App").constant("__api",{base:"http://www.sports.ru",paths:{search:"/search/search.json"}}),angular.module("App").run([function(){}]),angular.module("App").controller("C_background",["$state","$scope","PS_lastfm",function(e,t){var n=this,o="/images/background/intro.jpg";return n.image=o,t.$on("artistInfoRecievedFromLF",function(e,t){n.image=t.image}),t.$on("$stateChangeStart",function(e,t,a,r){"artistpage"!==r.name&&"artistpage.section"!==r.name||"artistpage"===t.name||"artistpage.section"===t.name||(n.image=o)}),n}]),angular.module("App").directive("autocompleteArea",[function(){return{scope:{info:"=",withButton:"=",info:"="},templateUrl:"templates/directives/autocompleteArea.html",controller:"CD_autocompleteArea as ctr",link:function(e,t){if(e.withButton){var n="notShowing",o=t.find("input"),a=$(document.createElement("div")).html("Сравнить с другим игроком").addClass("onfocusbutton btn btn-primary").on("click",function(){o.trigger("focus"),$(this).addClass(n)}).appendTo(t.find('[data-role="area"]'));o.on("blur",function(){""===$(this).val()&&a.removeClass(n)})}}}}]),angular.module("App").directive("colorPicker",[function(){return{scope:{},link:function(e,t){t.ColorPickerSliders({placement:"right",hsvpanel:!0,sliders:!1,swatches:!1,previewformat:"hex"})}}}]),angular.module("App").directive("customSelect",function(){return{transclude:!0,scope:{selectId:"=customSelect",closeOnSelect:"=",options:"=",sectionFormat:"=",sectionDefault:"=",optionFormat:"=",optionDisabled:"&",optionActive:"&",onSelect:"&",options:"=",customContent:"="},controller:"CD_customSelect as cSCtr",templateUrl:"templates/directives/customSelect.html",link:function(e,t,n,o,a){var r=e.$parent.$new(),i=e;a(r,function(e,n){n.$close=i.cSCtr.close,t.find('[data-role="custom-content"]').append(e)}),t.find("menu").on("click",function(e){e.stopPropagation()})}}}),angular.module("App").directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ngEnter)}),t.preventDefault())})}}),angular.module("App").service("S_api",["$http","$q","__api",function(e,t,n){var o={},a=n.base;return o.searchByQuery=function(t){return e({url:a+n.paths.search,method:"GET",params:{query:t,only:"tags"}})},o.getTournamentsList=function(){var e=t.defer();return e.resolve({tournamet_list:[{name:"Российская премьер-лига",seasons:[{id:354,name:"Сезон 2014/15"},{id:355,name:"Сезон 2013/14"},{id:356,name:"Сезон 2012/13"}],id:12423533},{name:"Какая-то еще лига",seasons:[{id:1355,name:"Сезон 2013/14"},{id:1356,name:"Сезон 2012/13"}],id:12423533}]}),e.promise},o}]),angular.module("App").service("S_utils",["$q",function(e){var t={};return t.loadImage=function(t){var n=e.defer(),o=new Image;return o.src=t,o.onload=function(){n.resolve(this)},o.onerror=function(){n.reject(this)},n.promise},t}]),angular.module("App").controller("CD_autocompleteArea",["$scope","S_api",function(e,t){var n=this;return n.searchByQuery=function(e){return t.searchByQuery(e).then(function(e){return e.data.suggestions})},n.onTagSelect=function(t){e.info=t},n}]),angular.module("App").controller("CD_customSelect",["$timeout","$scope","$interpolate","$sce",function(e,t,n,o){var a=this;return t.length=123,t.$watch("sectionFormat",function(){t.section=o.trustAsHtml(n("<span>"+t.sectionFormat+"</span>")(t))}),a.close=function(){a.opened=!1,$("body").off("click")},a.open=function(){a.opened=!a.opened,a.opened?e(function(){$("body").on("click",function(){t.$apply(function(){a.opened=!1}),$(this).off("click")})}):$("body").off("click")},a.isDisabled=function(e){return t.optionDisabled()?t.optionDisabled()(e,t.selectId):void 0},a.isActive=function(e){return t.optionActive()?t.optionActive()(e,t.selectId):void 0},a.selectOption=function(e,n){e.stopPropagation(),t.selected=n,t.closeOnSelect&&a.open()},a}]),angular.module("App").controller("CV_index",["$state","$q","$scope","S_api","S_utils",function(e,t,n,o,a){var r=this;return r.leftSideInfo={selectedTournament:{},selectedSeason:{},info:{}},r.rightSideInfo={selectedTournament:{},selectedSeason:{},info:{}},n.$watch(function(){return r.leftSideInfo.info},function(e){e&&(r.leftSideInfo.info=e,t.all({image:a.loadImage(e.img),tournaments:o.getTournamentsList(e)}).then(function(e){r.leftSideInfo.preloadingTagInfo=!1,r.leftSideInfo.tournaments=e.tournaments.tournamet_list}),r.leftSideInfo.preloadingTagInfo=!0)}),n.$watch(function(){return r.rightSideInfo.info},function(e){e&&(r.rightSideInfo.info=e,t.all({image:a.loadImage(e.img),tournaments:o.getTournamentsList(e)}).then(function(e){r.rightSideInfo.preloadingTagInfo=!1,r.rightSideInfo.tournaments=e.tournaments.tournamet_list}),r.rightSideInfo.preloadingTagInfo=!0)}),r.getCollectorByKey=function(e){return e?r.rightSideInfo:r.leftSideInfo},r.secondTagIsReady=function(){return r.showTagInfo[1]},r.selectParam=function(e,t,n){switch(n){case"tour":r.getCollectorByKey(e).selectedTournament.name!==t.name&&(r.getCollectorByKey(e).selectedSeason={}),r.getCollectorByKey(e).selectedTournament=t,r.getCollectorByKey(e).seasons=t.seasons;break;case"season":r.getCollectorByKey(e).selectedSeason=t}},r.paramIsActive=function(e,t,n){switch(n){case"tour":return r.getCollectorByKey(e).selectedTournament.name===t.name;case"season":return r.getCollectorByKey(e).selectedSeason.name===t.name}},r.tournamentsIsLoaded=function(e){return r.getCollectorByKey(e).tournaments},r.tournamentIsSelected=function(e){return r.getCollectorByKey(e).selectedTournament.name},r.seasonIsSelected=function(e){return r.getCollectorByKey(e).selectedSeason.name},r.statsButtonIsActive=function(){return r.rightSideInfo.info.name?r.seasonIsSelected(0)&&r.seasonIsSelected(1):r.seasonIsSelected(0)},r.getSelectPlaceholder=function(e,t){switch(t){case"tour":return r.getCollectorByKey(e).selectedTournament.name?r.getCollectorByKey(e).selectedTournament.name:"Выберите турнир";case"season":return r.getCollectorByKey(e).selectedSeason.name?r.getCollectorByKey(e).selectedSeason.name:"Выберите сезон"}return r.selectedParams[e].description?r.selectedParams[e].description:"Выберите параметр"},r}]),angular.module("App").controller("CV_stats",["$state","$scope","S_api",function(){var e=this;return e}]);